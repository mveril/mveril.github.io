---
ytitle: 'Windows Subsystem for Linux as a theoretical chemist (Part I)'
date: 2019-03-14
permalink: /posts/2019/03/wsl-part-1/
tags:
  - WSL
  - Windows
  - Linux
  - Development
  - OpenSources
---

Windows Subsystem for Linux as a theoretical chemist (Part 1)
======

[TOC]



## Windows Subsystem for Linux. Why ?


In my lab a lot of people use Linux the others use MacOS. It's because a lot of programs used in quantum chemistry was designed for Unix type OS. And consequently to work decently we must have a Unix type OS.

We use for example SSH, python, fortran compilers and a lot of quantum chemistry software designed for Unix.

For me it's because this programs are console programs and Unix type OS are so better for console usage. There are a lot of great shell like bash compared to Windows and it cmd (Even though I recognize which Microsoft has made a big effort with Windows PowerShell) but I am not convinced by graphical user interfaces present on Linux and there is also a big lack of compatibility with very common programs. I experimented also drivers issues with printers and GPU.

That's how I will schematize things if I must make OS ranking.

<table>
    <thead>
        <tr>
            <th>Graphical user interface</th>
            <th>Command line interface</th>
            <th>Compatibility</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan=2> Windows and MacOS</td>
            <td>Linux</td>
            <td>Windows</td>
        </tr>
        <tr>
            <td>MacOS</td>
            <td>MacOS</td>
        </tr>
        <tr>
            <td>Linux</td>
            <td>Windows</td>
            <td>Linux</td>
        </tr>
    </tbody>
</table>


So I understand why many of my college chose MacOS. It seems to be the best of two world (I use also MacOS on my office). And it's almost the only way for that (Without dual-boot or virtualization)... Until 2016. Since this year there are also a good way for that included in the core of Windows 10.

## Bash on Ubuntu On Windows

At the build 2016 conference Kevin Galo in the head of the Windows developer platform, presented a way to run native Linux binaries and Linux distributions directly on Windows 10.

At this point this technology was called Bash on Ubuntu on Windows (You can watch the video of the keynote bellow). And at this time only Ubuntu distribution was available.

<iframe src="https://channel9.msdn.com/Events/Build/2016/KEY01/player#time=38m18s:paused" width="939.9999389648437" height="528.75" allowFullScreen frameBorder="0"></iframe>

A year later this technology went out of beta with major improvements and also supports of any Linux distributions. So the name "Bash on Ubuntu On Windows" was replaced by "Windows Subsystem For Linux" (a.k.a WSL).


## The environment

With WSL you can have a Linux command line interface with your favorite distribution and your favorite shell directly inside the Windows console host (or any alternative console available on Windows).

Your Windows hard drives are automatically mounted (typically on /mnt/) and your Windows programs are also added to the path. and so you can run native Linux programs and windows programs. inside a true Linux environment and we can interact with our windows file in it.

## It's magic ! No it's Linux => Windows syscall conversion.

Because the binaries are Linux binaries. They attends to interact with Linux Kernel. So how does it work ? This is thanks to the magic of a technology called pico processes. Pico processes are a category of processes handled by windows where we have a minimal process. i.e. no Windows dll has loaded, also a pico provider which is a kernel-mode driver (lxss.sys) is placed between the windows kernel and the process and provide the interface. So the pico provider provide all the kernel interface and convert Linux syscall to equivalent windows kernel syscall.
For a Linux process inside a windows pico process the kernel is a true Linux kernel and the provider ensures compatibility.

> **WARNING**
>
> Because all syscall are not implemented so **There is no guarantee that a specific program works**
>
> A well know example is the docker daemon

## How to install it on your machine

> **NOTE**
>
> For the installation process I add direct link to Windows 10 settings App pages and Microsoft store pages when its relevant to simplify your installation process. So this links not work on a non Windows 10 OS.

### Prerequisites to install WSL

- A 64Bits operating system (x86-64 or arm64)

- Windows 10 fall creator update or greater

You can check your system configuration in the [system](ms-settings:about) page of the settings App.
We must have the above configuration.

| System type              | Windows 10 version |
| ------------------------ | ------------------ |
| 64 Bits operating system | 1709 or above      |

 If you have a 64Bits OS but an older version of Windows 10 you must update your OS. You can use [Windows update](ms-settings:windowsupdate) from the Windows Settings app to update your windows 10 version for free.

{% include hyperlink-button.html content="Check for update now" url="ms-settings:windowsupdate-action" %}

  

### Install the Windows Subsystem for Linux optional feature

Different methods are possible

### By command line

Generally peoples who want to install WSL are comfortable with command line interfaces. So it's may be the simplest way for you.

#### With PowerShell

Open a PowerShell console as administrator and type the following command

```powershell
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

Reboot the PC

#### With DISM

Open a PowerShell or cmd console as administrator and type the following command

```batch
Dism /online /Enable-Feature /FeatureName:Microsoft-Windows-Subsystem-Linux
```

Reboot the PC

#### With the [chocolatey](https://chocolatey.org/) package manager

Open a PowerShell or cmd console as administrator and type the following command

```
choco install Microsoft-Windows-Subsystem-Linux --source windowsfeatures
```

Reboot the PC

### By graphical user interface

You can find the Windows Subsystem for Linux as an optional feature in control panel

Open **[Application and features](ms-settings:appsfeatures)** from the Windows Settings app and click on **programs and features** => **Enable or disable Windows feature**

> **TIP**
>
> **To go directly to this window.**
>
> Press <kbd>![WindowsKey](http://i.stack.imgur.com/B8Zit.png)</kbd>+<kbd>R</kbd>
>
> Write **optionalfeatures** on the run box and press enter

check **Windows Subsystem for Linux** and click on the ok button.

Follow instructions

### Download distribution from the store

Now go to the [WSL page](https://aka.ms/wslstore) on the Microsoft store to chose your distribution and download the associated app.

> **TIP**
>
> You can install and use multiple distros at the same time

![View of Linux distributions in the Microsoft Store](https://docs.microsoft.com/en-us/windows/wsl/media/store.png)



After the app installation, launch it. The distribution was present as taball file inside the app and at the first launch the tarball was extracted and the app ask you to create a user account. Set your Linux username and password (It can be different to your Windows user name and pasword.)

After you can play with the Linux distribution you have chosen and you can install and run programs from the Linux world in it exactly like a true Linux OS .

if you are not convinced that this is a real Linux environment you can type the following line of code on the distribution console

```bash
file /bin/bash
```

you can see

```
/bin/bash: ELF 64-bit [...] for GNU/Linux [...]
```

so bash is in the Executable and Linkable Format, the format used by Linux OS (and other BSD OS) for executable files and is compiled for the Linux kernel.

So bash (and the other binaries of the distribution) are true Linux binaries.

The Linux distributions distributed on the Microsoft Store are published by its maintainers and are almost the same as the ISO distributed version (But by default without graphical programs and for Kali Linux without pentest programs) we can download all programs supported by the distribution with the packages manager because programs was downloaded on the same repositories. and of course you can also compile programs from sources, or download directly Linux binaries from the web.

> ### Useful resources
> [Official installation guide](https://aka.ms/wslinstall)

## Launch WSL

### From graphical user interface

Launch the distro app you installed previously to open a console window with this distro.

### From command line

To launch WSL there are multiple possibilities

- Launch a specific distro at the Linux home directory

  ```powershell
  <distroname>
  ```
- Launch the default distro in the current directory

  ```powershell
  wsl
  ```
- Launch the bash shell (and override the default shell) with the default distro in the Linux home directory

  ```powershell
  bash
  ```
- Launch a specific distro in the current directory

  ```powershell
  wsl -d <distroname>
  ```

For more info and learn how to configure the default distro (If we have multiple distros installed) check the documentation [here](https://docs.microsoft.com/en-us/windows/wsl/wsl-config)

## Windows Linux interoperability with WSL

### Windows Drives

- You have access to your Windows fixed drives by default (typically on /mnt)

- You can mount other windows drive like USB key with the Linux classical mount command like this

  ```bash
  sudo mount -t drvfs F: /mnt/f
  ```

  > **TIP**
  >
  > To mount a Windows drive and set owner and group to your user and your main group run :
  >
  > ```bash
  > sudo mount -t drvfs F: /mnt/f -o uid=$(id -u),gid=$(id -g)
  > ```
  >

  A lot of option are available

  More info [here](https://blogs.msdn.microsoft.com/commandline/2018/01/12/chmod-chown-wsl-improvements/)

### Run executable

- You can use Windows command line from WSL like this

  ```bash
  cmd.exe
  ```

- You can use Linux command line from windows console like this

  ```powershell
  wsl git clone https://github.com/username/repo
  ```

  or like this
    ```powershell
  <disro name> run git clone https://github.com/username/repo
    ```

  [See the official guide to invoking WSL](https://blogs.msdn.microsoft.com/commandline/2017/11/28/a-guide-to-invoking-wsl/)

- You can also combine Windows and Linux command like this
  For example to print windows version with Linux lolcat (Rainbow colors) in cmd you can type

  ```batch
  ver | wsl lolcat
  ```

More information [here](https://blogs.msdn.microsoft.com/commandline/2016/10/19/interop-between-windows-and-bash/)

### Share environment variables

You can share environment variable between Linux and Windows. more info [here](https://blogs.msdn.microsoft.com/commandline/2017/12/22/share-environment-vars-between-wsl-and-windows/).

So with a good configuration you can do this:

  ```bash
  cd $USERPROFILE
  ```

And go to your Windows user directory.

And more interop and other WSL features comes twice per year with each new version of Windows 10.

### Change distribution launch behavior

You can configure the wsl functionality of a distro in the in the `wsl.conf` file

More info [here](https://docs.microsoft.com/en-us/windows/wsl/wsl-config#set-wsl-launch-settings)

## WSL vs other technologies

|                              | WSL                                                          | Dual-Boot                                                    | Virtual machine (VM)                                         | CyGwin                                                       |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Binaries                     | <span style="color:green;">Native linux binaries</span>      | <span style="color:green;">Native linux binaries</span>      | <span style="color:green;">Native linux binaries</span>      | <span style="color:red;">Windows Binaries</span>             |
| Windows<=>Linux interop      | <span style="color:green;">Very good interop</span>          | <span style="color:red;">No interop at all</span>            | <span style="color:orange;">Network and file sharing possible</span> | <span style="color:green;">Very good interop because it's windows binaries</span> |
| Linux binaries recompilation | <span style="color:green;">Not required</span>               | <span style="color:green;">Not required</span>               | <span style="color:green;">Not required</span>               | <span style="color:red;">Required</span>                     |
| Performance                  | <span style="color:orange;">Bad file IO performance..</span> | <span style="color:green;">The best performances</span>      | <span style="color:red;">Bad performance because hardware has emulated and we can give just a part of the machine to the VM</span> | ?                                                            |
| Reboot required              | <span style="color:green;">No</span>                         | <span style="color:red;">Yes</span>                          | <span style="color:green;">No</span>                         | <span style="color:green;">No</span>                         |
| Official Linux distribution  | <span style="color:green;">Yes</span>                        | <span style="color:green;">Yes</span>                        | <span style="color:green;">Yes</span>                        | <span style="color:red;">No</span>                           |
| Syscall handler and handling | <span style="color:orange;">lxss.sys (a Linux compatibility layer driver in kernel mode). All Syscall are not implemented. No GPU access. (Can be evolved)</span> | <span style="color:green;">The true linux Kernel. So all syscall are handled.</span> | <span style="color:green;"><span style="color:green;">The true linux Kernel. So all syscall are handled.</span></span> | <span style="color:red;">Cygwin1.dll  (A POSIX compatibility layer dynamic library in User mod) and the Windows kernel</span> |

## Useful resources

[Official documentation](https://aka.ms/wslabout)

[Learn About Windows Console & Windows Subsystem For Linux (WSL)](http://aka.ms/learnwsl)

[WSL in windows command line blog](https://blogs.msdn.microsoft.com/commandline/tag/wsl/)

## Future posts

In the first part of this series of post we

Here we seen why we can want to use WSL. How does it work, how to install it, how to use Interop functionality and comparison with other alternatives.

In futures post we will see.

- A tweak on WSL to work with an X server for local Linux programs and remote SSH server too.
- A practical example of running a quantum chemistry software in WSL and a tips to avoid prevent the antivirus from using a large portion of the CPU.
